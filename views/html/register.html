<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/views/static/css/registerstyle.css">
    <title>Registro</title>
</head>

<body>
    <nav class="navbar">
        <div class="logo">
            <h1>Tecnoautoritarismo</h1>
        </div>
    </nav>
    <section>
        <div class="form-box">
            <div class="form-value">
                <form action="/views/html/register.html">
                    <h2 style="font-size: 34px; color: white; font-family: 'Pixelify Sans', cursive;">Registro</h2>
                    <div class="inputbox">
                        <ion-icon name="mail-outline"></ion-icon>
                        <input type="email" oninput="checkValue(this)" required id="get_email">
                        <label for="email">Email</label>
                    </div>
                    <div class="inputbox" style="position: relative;">
                        <input type="password" id="password" required>
                        <label for="password">Senha</label>
                        <ion-icon id="eyeIcon" name="eye-off-outline" onclick="togglePassword()" style="cursor: pointer; position: absolute; right: 10px; top: 50%; transform: translateY(-50%);"></ion-icon>
                    </div>
                    <div class="inputbox">
                        <input type="name" required id="get_nome_completo">
                        <label for="name">Nome completo</label>
                    </div>
                    <div class="inputbox">
                        <input type="username" required id="get_username">
                        <label for="username">Nome do usuário</label>
                    </div>
                    <button class="button" onclick="cadastrar_usuarios()">Cadastre-se</button>
                </form>
            </div>
        </div>
        <div class="form-stepbox">
            <div class="register">
                <p>Possui uma conta? <a href="/views/html/login.html">Conecte-se</a></p>
            </div>
        </div>
    </section>
    <footer class="footer">
        <p>© 2025 Tecnoautoritarismo</p>
    </footer>

    <script>

        async function getLen() {
            try {
                const response = await fetch("http://localhost:8000/get_len");
                const data = await response.json();
                return data.Tamanho; 
            } catch (error) {
                console.error(error)
            }
        }

        async function cadastrar_usuarios() {


            const nomeCompleto = document.querySelector("#get_nome_completo").value;
            const nomeArray = nomeCompleto.trim().split(" ");
            const nome = nomeArray[0];
            const sobrenome = nomeArray.slice(1).join(" ");

            try {

                let idUsuario = await getLen() + 1

                const response = await fetch("http://localhost:8000/cadastro", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        id: idUsuario || 98,
                        usuario: document.querySelector("#get_usuario").value,
                        senha: document.querySelector("#get_senha").value,
                        nome: nome,
                        sobrenome: sobrenome,
                        cargo: "usuario",
                        email: document.querySelector("#get_email").value,
                    }),
                });

                const dados = await response.json()

                console.log(dados)
            } catch (error) {
                console.error("Erro na requisição: ", error)
            }
        }

    </script>
    <script src="/views/javascript/cadastro.js" defer></script>
    <script src="/views/javascript/script.js"></script>
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    
</body>

</html>